data = mydata,
family = Gamma
)
names(mydata)
#' mcp model
m1 <- glmer(
mcp ~ sex + age +  ndvi_Mean + altitude_Mean + slope_Mean + aspect_Mean + predator + corine_Mode + tree_Mode + age +  mean_act +
(1|study_areas_id) + (1|month) +
(1|study_areas_id:month) +
(1|animals_id),
data = mydata,
family = Gamma
)
#' load the data
mydata <- read_csv("results/combined_data.csv", col_names = TRUE)
head(mydata)
names(mydata)
#' mcp model
m1 <- glmer(
mcp ~ sex + age +  ndvi_Mean + altitude_Mean + slope_Mean + aspect_Mean + predator + corine_Mode + tree_Mode + age +  mean_act +
(1|study_areas_id) + (1|month) +
(1|study_areas_id:month) +
(1|animals_id),
data = mydata,
family = Gamma
)
m1 <- glmer(
mcp ~
# sex +
age +
ndvi_Mean +
altitude_Mean +
slope_Mean +
aspect_Mean +
predator +
corine_Mode +
tree_Mode +
age +
mean_act * activity_sensors_id +
(1 | study_areas_id) + (1 | month) +
(1 | study_areas_id:month) +
(1 | animals_id),
data = mydata,
family = Gamma
)
class(mydata$activity_sensors_i)
class(mydata$age)
#' mcp model
m1 <- glmer(
mcp ~
sex +
age +
ndvi_Mean +
altitude_Mean +
slope_Mean +
aspect_Mean +
predator +
corine_Mode +
tree_Mode +
age +
mean_act * activity_sensors_id +
(1 | study_areas_id) + (1 | month) +
(1 | study_areas_id:month) +
(1 | animals_id),
data = mydata
)
m1 <- glmer(
mcp ~
sex +
age +
ndvi_Mean +
altitude_Mean +
slope_Mean +
aspect_Mean +
predator +
corine_Mode +
tree_Mode +
age +
mean_act * activity_sensors_id +
sd_act * activity_sensors_id +
(1 | study_areas_id) + (1 | month) +
(1 | study_areas_id:month) +
(1 | animals_id),
data = mydata,
family = Gamma
)
glmer(
mcp ~
sex +
age +
ndvi_Mean +
altitude_Mean +
slope_Mean +
aspect_Mean +
predator +
corine_Mode +
tree_Mode +
age
)
glmer(
mcp ~
sex +
age +
ndvi_Mean +
altitude_Mean +
slope_Mean +
aspect_Mean +
predator +
corine_Mode +
tree_Mode +
age
data = mydata,
family = Gamma
)
glmer(
mcp ~
sex +
age +
ndvi_Mean +
altitude_Mean +
slope_Mean +
aspect_Mean +
predator +
corine_Mode +
tree_Mode +
age
,
data = mydata,
family = Gamma
)
glmer(
mcp ~
sex +
age +
ndvi_Mean +
altitude_Mean +
slope_Mean +
aspect_Mean +
predator +
corine_Mode +
tree_Mode +
age
,
(1 | animals_id)
,
data = mydata,
family = Gamma
)
m1 <- glmer(
mcp ~
sex +
age +
ndvi_Mean +
altitude_Mean +
slope_Mean +
aspect_Mean +
predator +
corine_Mode +
tree_Mode +
age +
#  mean_act * activity_sensors_id +
#  sd_act * activity_sensors_id +
#  (1 | study_areas_id) + (1 | month) +
#  (1 | study_areas_id:month) +
(1 | animals_id),
data = mydata,
family = Gamma
)
class(mydata$predator)
mydata$predator
m1 <- glmer(
mcp ~
sex +
age +
ndvi_Mean +
altitude_Mean +
slope_Mean +
aspect_Mean +
predator +
corine_Mode +
#    tree_Mode +
age +
#  mean_act * activity_sensors_id +
#  sd_act * activity_sensors_id +
#  (1 | study_areas_id) + (1 | month) +
#  (1 | study_areas_id:month) +
(1 | animals_id),
data = mydata,
family = Gamma
)
m1 <- glmer(
mcp ~
sex +
age +
ndvi_Mean +
altitude_Mean +
slope_Mean +
aspect_Mean +
predator +
#    corine_Mode +
#    tree_Mode +
age +
#  mean_act * activity_sensors_id +
#  sd_act * activity_sensors_id +
#  (1 | study_areas_id) + (1 | month) +
#  (1 | study_areas_id:month) +
(1 | animals_id),
data = mydata,
family = Gamma
)
m1 <- glmer(
mcp ~
sex +
age +
ndvi_Mean +
altitude_Mean +
slope_Mean +
aspect_Mean +
#    predator +
#    corine_Mode +
#    tree_Mode +
age +
#  mean_act * activity_sensors_id +
#  sd_act * activity_sensors_id +
#  (1 | study_areas_id) + (1 | month) +
#  (1 | study_areas_id:month) +
(1 | animals_id),
data = mydata,
family = Gamma
)
#' mcp model
m1 <- glmer(
mcp ~
sex +
age +
ndvi_Mean +
#    altitude_Mean +
#    slope_Mean +
#    aspect_Mean +
#    predator +
#    corine_Mode +
#    tree_Mode +
age +
#  mean_act * activity_sensors_id +
#  sd_act * activity_sensors_id +
#  (1 | study_areas_id) + (1 | month) +
#  (1 | study_areas_id:month) +
(1 | animals_id),
data = mydata,
family = Gamma
)
m1 <- glmer(
mcp ~
sex +
age +
ndvi_Mean +
#    altitude_Mean +
#    slope_Mean +
#    aspect_Mean +
#    predator +
#    corine_Mode +
#    tree_Mode +
#    age +
#  mean_act * activity_sensors_id +
#  sd_act * activity_sensors_id +
#  (1 | study_areas_id) + (1 | month) +
#  (1 | study_areas_id:month) +
(1 | animals_id),
data = mydata,
family = Gamma
)
#' mcp model
m1 <- glmer(
mcp ~
#    sex +
#    age +
ndvi_Mean +
#    altitude_Mean +
#    slope_Mean +
#    aspect_Mean +
#    predator +
#    corine_Mode +
#    tree_Mode +
#    age +
#  mean_act * activity_sensors_id +
#  sd_act * activity_sensors_id +
#  (1 | study_areas_id) + (1 | month) +
#  (1 | study_areas_id:month) +
(1 | animals_id),
data = mydata,
family = Gamma
)
m1 <- glmer(
mcp ~
#    sex +
#    age +
ndvi_Mean +
#    altitude_Mean +
#    slope_Mean +
#    aspect_Mean +
#    predator +
#    corine_Mode +
#    tree_Mode +
#    age +
#  mean_act * activity_sensors_id +
#  sd_act * activity_sensors_id +
#  (1 | study_areas_id) + (1 | month) +
#  (1 | study_areas_id:month) +
(1 | animals_id),
data = mydata#,
#family = Gamma
)
summary(m1)
#' https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/j.2041-210X.2009.00001.x
#'  to extract variance inflation factors (VIF) run the Helper functions code and use the function corvif.
#'  The function requires a data frame with just the predictors (so, for example, df = data.frame(Dataset[,2:4])
#'  if your data are stored in Dataset with the predictors in columns 2 to 4.
test_vif <- mydata %>% select(ndvi_Mean,altitude_Mean,slope_Mean,aspect_Mean,corine_Mode,tree_Mode,mean_act,sd_act)
myvif(test_vif)
test_vif <- data.frame(test_vif)
myvif(test_vif)
corvif <- function(dataz) {
dataz <- as.data.frame(dataz)
#correlation part
cat("Correlations of the variables\n\n")
tmp_cor <<- cor(dataz,use="complete.obs")
print(tmp_cor)
#vif part
form    <- formula(paste("fooy ~ ",paste(strsplit(names(dataz)," "),collapse=" + ")))
dataz   <- data.frame(fooy=1,dataz)
lm_mod  <- lm(form,dataz)
cat("\n\nVariance inflation factors\n\n")
print(myvif(lm_mod))
}
corvif <- function(dataz) {
dataz <- as.data.frame(dataz)
#correlation part
cat("Correlations of the variables\n\n")
tmp_cor <<- cor(dataz,use="complete.obs")
print(tmp_cor)
#vif part
form    <- formula(paste("fooy ~ ",paste(strsplit(names(dataz)," "),collapse=" + ")))
dataz   <- data.frame(fooy=1,dataz)
lm_mod  <- lm(form,dataz)
cat("\n\nVariance inflation factors\n\n")
print(myvif(lm_mod))
}
corvif(test_vif)
corvif(test_vif)
#' https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/j.2041-210X.2009.00001.x
#' extract variance inflation factors (VIF)
test_vif <- mydata %>% select(ndvi_Mean,altitude_Mean,slope_Mean,aspect_Mean,tree_Mean,mean_act,sd_act)
test_vif <- data.frame(test_vif)
#' function for vif
corvif <- function(dataz) {
dataz <- as.data.frame(dataz)
#correlation part
cat("Correlations of the variables\n\n")
tmp_cor <<- cor(dataz,use="complete.obs")
print(tmp_cor)
#vif part
form    <- formula(paste("fooy ~ ",paste(strsplit(names(dataz)," "),collapse=" + ")))
dataz   <- data.frame(fooy=1,dataz)
lm_mod  <- lm(form,dataz)
cat("\n\nVariance inflation factors\n\n")
print(myvif(lm_mod))
}
corvif(test_vif)
#' mcp model
m1 <- glmer(
mcp ~
sex +
age +
ndvi_Mean +
#    altitude_Mean +
slope_Mean +
aspect_Mean +
predator +
corine_Mode +
tree_Mean +
age +
#  mean_act * activity_sensors_id +
sd_act * activity_sensors_id +
(1 | study_areas_id) + (1 | month) +
(1 | study_areas_id:month) +
(1 | animals_id),
data = mydata#,
#family = Gamma
)
summary(m1)
#'##########################################################################
#' ame1 project - studying the relation between home range size and activity
#' 2019/10/04
#' Adam Kane, Enrico Pirotta & Barry McMahon
#' https://mecoco.github.io/ame1.html
#' statistical model
############################################################################
#' load the packages
library(tidyverse)
library(lme4)
#' load in some helper functions e.g. for calculating VIF
source("code/6.Helper_functions.r")
#' load the data
mydata <- read_csv("results/combined_data.csv", col_names = TRUE)
head(mydata)
names(mydata)
#' extract variance inflation factors (VIF)
#' https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/j.2041-210X.2009.00001.x
test_vif <- mydata %>% select(ndvi_Mean,altitude_Mean,slope_Mean,aspect_Mean,tree_Mean,mean_act,sd_act)
test_vif <- data.frame(test_vif)
corvif(test_vif)
#' mean_act is correlated with sd_act and
#' altitude_mean is correlated with slope mean
#' let's remove mean_act and altitude_mean
#' mcp model
m1 <- glmer(
mcp ~
sex +
age +
ndvi_Mean +
#    altitude_Mean +
slope_Mean +
aspect_Mean +
predator +
corine_Mode +
tree_Mean +
age +
#  mean_act * activity_sensors_id +
sd_act * activity_sensors_id +
(1 | study_areas_id) + (1 | month) +
(1 | study_areas_id:month) +
(1 | animals_id),
data = mydata#,
#family = Gamma
)
summary(m1)
#' mcp model
m1 <- glmer(
mcp ~
sex +
age +
ndvi_Mean +
#    altitude_Mean +
slope_Mean +
aspect_Mean +
predator +
corine_Mode +
tree_Mean +
age +
#  mean_act * activity_sensors_id +
sd_act * activity_sensors_id +
(1 | study_areas_id) + (1 | month) +
(1 | study_areas_id:month) +
(1 | animals_id),
data = mydata,
family = Gamma
)
#'##########################################################################
#' ame1 project - studying the relation between home range size and activity
#' 2019/11/04
#' Adam Kane, Enrico Pirotta & Barry McMahon
#' https://mecoco.github.io/ame1.html
#' merging data
############################################################################
library(tidyverse)
library(lubridate)
#' load in HR data
hr <- read_csv("results/home_range_month.csv" , col_names = TRUE)
#' load in environmental data
env <- read_csv("results/env_data.csv" , col_names = TRUE)
#' load in activity data
#' new 5 min interpolated activity data
activity <- read_csv("results/Activity_data_byMonth_5min.csv.csv" , col_names = TRUE)
#' merge the first 2
merge1 <- merge(hr,env,c("identifier")) %>% select(-id.x, -id.y)
#' new 5 min interpolated activity data
activity <- read_csv("results/Activity_data_byMonth_5min.csv" , col_names = TRUE)
#' merge the first 2
merge1 <- merge(hr,env,c("identifier")) %>% select(-id.x, -id.y)
head(merge1)
#' make an identifier so it matches the other output
#' add a leading zero
activity$month <- sprintf("%02d",activity$month) # fix to 2 characters
head(activity)
activity$identifier <- sub(" ", "/", sub(" ", "_", activity$group)) %>% select(-group)
activity$identifier <- sub(" ", "/", sub(" ", "_", activity$group))
activity <- activity %>% select(-group)
head(activity)
merge2 <- merge(merge1,activity,c("identifier"))
head(merge2)
#' merge with individual descriptions
animal <- read_csv("data/animalsensordata_mecoco.csv" , col_names = TRUE)
head(animal)
#' select only relevant columns
animal <- animal %>% select(animals_id, sex, year_birth)
#' we need to append individual descriptions using aniamls_id
all_data <- merge(animal, merge2, by = "animals_id")
#' now calculate age
all_data$age <- all_data$year - all_data$year_birth
head(all_data)
all_data$predator <- ifelse(all_data$study_areas_id == 25 | all_data$study_areas_id == 1 | all_data$study_areas_id == 2, 2, 1)
all_data$predator <- ifelse(all_data$study_areas_id == 16, 3, all_data$predator)
head(all_data)
tail(all_data)
#' check that study area 16 has 3 predators
filter(all_data, study_areas_id == 16)
#' check that study area 25 has 2 predators
filter(all_data, study_areas_id == 25)
#' check that study area 8 has 1 predator
filter(all_data, study_areas_id == 8)
#' export the results
write.csv(all_data, "results/combined_data.csv", row.names = F)
